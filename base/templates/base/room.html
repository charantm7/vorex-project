{% extends 'base.html' %} {% load static %}{% block title %}
<title>Room</title>
{% endblock %} {% block nav1 %}
<a href="#">/ {{rooms.name}}</a>
{% endblock %} {% block link %}
<!-- <link
  href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
  rel="stylesheet"
  integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
  crossorigin="anonymous"
/> -->
<link rel="stylesheet" href="{% static 'css/room.css' %}" />
{% endblock %} {% block content %}
<div class="rooms">
  <div class="tab">
    <button class="tablinks" onclick="openTab(event, 'Info')">
      <i class="fas fa-tachometer-alt"></i><span class="btn-txt">Dashboard</span>
    </button>
    <button class="tablinks" onclick="openTab(event, 'Group')" id="defaultOpen">
      <i class="fa-solid fa-user-group"></i><span class="btn-txt">Group</span>
    </button>
    <button class="tablinks" onclick="openTab(event, 'Materials')">
      <i class="fa-solid fa-book"></i><span class="btn-txt">Study Materials</span>
    </button>
  </div>
  <div id="Info" class="tabcontent">
    <div class="tabcontent-top">
      <div class="tabcontent-top-left">
        <i class="fa-solid fa-calculator"></i>
        <div class="tabcontent-top-left-1">
          <p>{{rooms.name}}</p>
          <small>{{rooms.description}}</small>
          <small>Created on: {{rooms.created_at|date:"Y F j"}}</small>
        </div>
      </div>
      <div class="tabcontent-top-right">
        <p>Created by:</p>
        <div class="tabcontent-top-right-1">
          <img src="{{profile.profile_pic.url}}" alt="img" />
          <a href="{% url 'Profile' rooms.created_by.username %}">@{{rooms.created_by.username}}</a>
        </div>
        <p>Squad stats: {{members}} Joined</p>
      </div>
    </div>
  </div>

  <div id="Group" class="tabcontent">
    <div class="create-chat-group">
      <div class="top">
        <p>Create Group</p>
        <i class="fas fa-times" onclick="Removegroup()"></i>
      </div>
      <form action="{% url 'Create-group-chat' rooms.name %}" method="post">
        {% csrf_token %}
        <div class="input-g-name">
          <label for="Group-name">Group Name</label>
          {{group_chat_form.group_name}}
        </div>
        <button type="submit" name="group_chat_submit">create</button>
      </form>
    </div>
    <div class="members">
      <div class="top">
        <div class="top-1">
          <p>Chat</p>
          <i class="fa-solid fa-plus" id="tooltip" onclick="Creategroup()">
            <span class="tooltiptext">Chat with individual</span>
          </i>
        </div>
        <div class="top-2">
          <input type="text" placeholder="Search" />
          <i class="fas fa-search"></i>
        </div>
      </div>

      <div class="bottom">
        <!-- Group Chat -->
        {% for group in group_chat %}
        <div class="members-chat" onclick="loadMessages('{{ rooms.name }}', 'group', '{{ group.id }}')">
          <div class="left">
            <img src="{% static 'assets/default.png' %}" alt="img" />
          </div>
          <div class="mid"><p>{{ group.group_name }}</p></div>
          <div class="right">
            <i class="fas fa-ellipsis-v" id="tooltip"><span class="tooltiptext">more</span></i>
          </div>
        </div>
        {% endfor %}

        <!-- Individual Chat -->
        {% for member in members_joined %}
        <div class="members-chat" onclick="loadMessages('{{ rooms.name }}', 'individual', '{{ member.id }}')">
          <div class="left">
            {% if member.profile.profile_pic %}
            <img src="{{ member.profile.profile_pic.url }}" alt="img" />
            {% endif %}
          </div>
          <div class="mid"><p>{{ member.username }}</p></div>
          <div class="right">
            <i class="fas fa-ellipsis-v" id="tooltip"><span class="tooltiptext">more</span></i>
          </div>
        </div>
        {% endfor %}
      </div>
    </div>
    <div class="chat-area">
      <div class="chat-area-top">
        <div class="chat-area-top-left">
          <p id="chat-title">Select a chat</p>
        </div>
        <div class="chat-area-top-right">
          <i class="fas fa-ellipsis-v" id="tooltip"><span class="tooltiptext">more</span></i>
        </div>
      </div>

      <div class="chat-area-mid" id="chat-messages">
        <!-- Messages will be loaded here -->
      </div>

      <form id="message-form" method="post" onsubmit="sendMessage(event)">
        {% csrf_token %}
        <div class="chat-area-bottom">
          <div class="chat-area-bottom-item">
            <input type="text" id="message-content" placeholder="Type a message..." required />
            <button type="submit">
              <i class="fas fa-paper-plane"></i>
            </button>
          </div>
        </div>
      </form>
    </div>
  </div>
  {% block materials %}
  <div id="Materials" class="tabcontent">
    <div class="materials-top">
      <div class="materials-top-left">
        <div class="materials-top-left-folder" id="tooltip" onclick="CreateFolder()">
          <i class="fa-solid fa-plus"></i>
          <p>New Folder</p>
          <span class="tooltiptext">Add Folder</span>
        </div>
        <div class="materials-top-left-code" title="Upload Your Code">
          <i class="fa-solid fa-plus"></i>
          <p>Code</p>
        </div>
      </div>

      <div class="materials-top-mid">
        <input type="text" placeholder="Search Notes" />
        <i class="fas fa-search"></i>
      </div>
    </div>

    <div class="create-folder">
      <div class="create-folder-top">
        <p>Create Folder</p>
        <i class="fas fa-times" onclick="closeFolder()"></i>
      </div>
      <div class="create-folder-bottom">
        <form action="{% url 'Create-folder' rooms.name %}" method="post">
          {% csrf_token %}
          <div class="input-folder-name">
            <label for="folder-name">Name</label>
            {{form.name}}
          </div>
          <button type="submit" name="folder_submit">Create</button>
        </form>
      </div>
    </div>

    <div class="materials-bottom">
      <div class="row g-3">
        {% for folder in folders %}
        <div class="col-6 col-sm-4 col-md-3 col-lg-2">
          <div class="card">
            <div class="card-top">
              <i class="fa-solid fa-folder-open"></i>
              <a href="{% url 'Folder' folder.name %}" title="{{folder.name}}">{{ folder.name }}</a>
            </div>
            <div class="card-bottom">
              <p>By: {{ folder.created_by.username|default:'Unknown' }}</p>
              {% if request.user == folder.created_by %}
              <a onclick="DeleteFolder('{{folder.name}}')"><i class="fa-solid fa-trash"> </i></a>

              {% endif %}
            </div>
          </div>
        </div>
        <div id="delete-{{ folder.name }}" class="delete" style="display: none">
          <div class="top">
            <p>Delete This Folder?</p>
          </div>
          <div class="bottom">
            <button class="cancel-btn" onclick="CancelDelete('{{ folder.name }}')">Cancel</button>
            <a href="{% url 'Delete-folder' rooms.name folder.name %}">
              <button class="delete-btn">Delete</button>
            </a>
          </div>
        </div>
        {% empty %}
        <div class="col-12 text-center">
          <p>No folders available.</p>
        </div>
        {% endfor %}
      </div>
    </div>
  </div>

  {% endblock %}
</div>
<script src="{% static 'js/room.js'%}"></script>
<script>
  function CreateFolder() {
    document.querySelector(".create-folder").style.display = "block";
  }
  function closeFolder() {
    document.querySelector(".create-folder").style.display = "none";
  }
  function DeleteFolder(folderName) {
    document.getElementById(`delete-${folderName}`).style.display = "flex";
  }

  function CancelDelete(folderName) {
    document.getElementById(`delete-${folderName}`).style.display = "none";
  }
  function Creategroup() {
    document.querySelector(".create-chat-group").style.display = "flex";
  }
  function Removegroup() {
    document.querySelector(".create-chat-group").style.display = "none";
  }
</script>
{% endblock %}
<!-- <i class="fa-solid fa-file-pdf"></i> -->
<!-- {% url 'Delete-folder' rooms.name folder.name %} -->
